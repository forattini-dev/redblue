/// Wordlist Management for Web Fuzzing
///
/// Handles loading, processing, and managing wordlists for fuzzing operations.
/// Supports various formats and built-in wordlists.

use std::collections::HashSet;
use std::fs::File;
use std::io::{BufRead, BufReader};
use std::path::Path;

/// Wordlist manager
pub struct WordlistManager {
    /// Loaded words
    words: Vec<String>,
    /// Deduplicated set for quick lookup
    seen: HashSet<String>,
}

impl WordlistManager {
    pub fn new() -> Self {
        Self {
            words: Vec::new(),
            seen: HashSet::new(),
        }
    }

    /// Load wordlist from file
    pub fn load_file(&mut self, path: &str) -> Result<usize, String> {
        let file = File::open(path).map_err(|e| format!("Failed to open wordlist: {}", e))?;
        let reader = BufReader::new(file);

        let mut count = 0;
        for line in reader.lines() {
            if let Ok(word) = line {
                let word = word.trim();
                if !word.is_empty() && !word.starts_with('#') {
                    if self.seen.insert(word.to_string()) {
                        self.words.push(word.to_string());
                        count += 1;
                    }
                }
            }
        }

        Ok(count)
    }

    /// Load from multiple files
    pub fn load_files(&mut self, paths: &[&str]) -> Result<usize, String> {
        let mut total = 0;
        for path in paths {
            if Path::new(path).exists() {
                total += self.load_file(path)?;
            }
        }
        Ok(total)
    }

    /// Add words directly
    pub fn add_words(&mut self, words: &[String]) {
        for word in words {
            if self.seen.insert(word.clone()) {
                self.words.push(word.clone());
            }
        }
    }

    /// Get all words
    pub fn words(&self) -> &[String] {
        &self.words
    }

    /// Get word count
    pub fn len(&self) -> usize {
        self.words.len()
    }

    /// Check if empty
    pub fn is_empty(&self) -> bool {
        self.words.is_empty()
    }

    /// Get built-in directory wordlist (SecLists common)
    pub fn builtin_directories() -> Vec<String> {
        vec![
            // Top directories (very common)
            "admin",
            "administrator",
            "api",
            "app",
            "application",
            "assets",
            "backup",
            "backups",
            "bin",
            "blog",
            "cache",
            "cgi-bin",
            "cms",
            "common",
            "config",
            "configs",
            "console",
            "content",
            "css",
            "dashboard",
            "data",
            "db",
            "debug",
            "demo",
            "dev",
            "docs",
            "download",
            "downloads",
            "error",
            "errors",
            "files",
            "fonts",
            "forum",
            "help",
            "home",
            "html",
            "images",
            "img",
            "inc",
            "include",
            "includes",
            "index",
            "info",
            "internal",
            "js",
            "json",
            "lib",
            "libs",
            "log",
            "login",
            "logs",
            "mail",
            "main",
            "media",
            "misc",
            "new",
            "news",
            "old",
            "page",
            "pages",
            "panel",
            "php",
            "phpinfo",
            "plugins",
            "portal",
            "private",
            "public",
            "register",
            "reports",
            "resources",
            "scripts",
            "search",
            "secure",
            "security",
            "server",
            "service",
            "services",
            "setup",
            "site",
            "static",
            "status",
            "storage",
            "store",
            "styles",
            "support",
            "system",
            "temp",
            "template",
            "templates",
            "test",
            "testing",
            "tests",
            "themes",
            "tmp",
            "tools",
            "upload",
            "uploads",
            "user",
            "users",
            "v1",
            "v2",
            "vendor",
            "video",
            "videos",
            "web",
            "webmail",
            "wp-admin",
            "wp-content",
            "wp-includes",
            "xml",
            // Extended common
            "account",
            "accounts",
            "ajax",
            "archive",
            "archives",
            "auth",
            "authentication",
            "avatar",
            "avatars",
            "banner",
            "banners",
            "batch",
            "billing",
            "build",
            "calendar",
            "captcha",
            "cart",
            "catalog",
            "category",
            "cdn",
            "certificate",
            "certs",
            "channel",
            "channels",
            "chat",
            "checkout",
            "class",
            "classes",
            "client",
            "clients",
            "comments",
            "components",
            "connect",
            "contact",
            "contacts",
            "control",
            "controller",
            "controllers",
            "core",
            "cpanel",
            "cron",
            "custom",
            "customer",
            "customers",
            "database",
            "databases",
            "default",
            "delete",
            "deploy",
            "deployment",
            "detail",
            "details",
            "development",
            "directory",
            "dist",
            "document",
            "documents",
            "domain",
            "domains",
            "draft",
            "drafts",
            "dump",
            "edit",
            "editor",
            "email",
            "emails",
            "embed",
            "engine",
            "enterprise",
            "entry",
            "env",
            "environment",
            "event",
            "events",
            "example",
            "examples",
            "exchange",
            "exec",
            "export",
            "exports",
            "external",
            "extranet",
            "facebook",
            "faq",
            "favicon",
            "feature",
            "features",
            "feed",
            "feedback",
            "feeds",
            "file",
            "filemanager",
            "filter",
            "filters",
            "finance",
            "flash",
            "folder",
            "folders",
            "form",
            "forms",
            "framework",
            "free",
            "frontend",
            "ftp",
            "function",
            "functions",
            "gallery",
            "game",
            "games",
            "gateway",
            "general",
            "generate",
            "get",
            "git",
            "github",
            "global",
            "google",
            "graph",
            "graphics",
            "graphql",
            "group",
            "groups",
            "guest",
            "guide",
            "handler",
            "handlers",
            "health",
            "helper",
            "helpers",
            "hidden",
            "history",
            "hook",
            "hooks",
            "host",
            "hosting",
            "hosts",
            "htaccess",
            "htdocs",
            "htpasswd",
            "http",
            "https",
            "i18n",
            "icon",
            "icons",
            "id",
            "image",
            "import",
            "imports",
            "inbox",
            "index.html",
            "index.php",
            "init",
            "install",
            "installer",
            "integration",
            "interface",
            "interfaces",
            "intern",
            "intranet",
            "invoice",
            "invoices",
            "iphone",
            "issue",
            "issues",
            "item",
            "items",
            "java",
            "javascript",
            "job",
            "jobs",
            "jquery",
            "key",
            "keys",
            "l10n",
            "lab",
            "labs",
            "landing",
            "language",
            "languages",
            "layout",
            "layouts",
            "legal",
            "library",
            "license",
            "link",
            "links",
            "list",
            "listing",
            "listings",
            "lists",
            "live",
            "load",
            "loader",
            "local",
            "locale",
            "locales",
            "location",
            "locations",
            "lock",
            "locked",
            "logout",
            "lost",
            "mac",
            "machine",
            "mailer",
            "mailing",
            "manage",
            "management",
            "manager",
            "manifest",
            "manual",
            "map",
            "maps",
            "marketing",
            "master",
            "member",
            "members",
            "membership",
            "menu",
            "menus",
            "message",
            "messages",
            "messaging",
            "meta",
            "metadata",
            "metric",
            "metrics",
            "middleware",
            "migration",
            "migrations",
            "mobile",
            "mock",
            "mocks",
            "mod",
            "model",
            "models",
            "moderation",
            "moderator",
            "module",
            "modules",
            "money",
            "monitor",
            "monitoring",
            "more",
            "mysql",
            "network",
            "newsletter",
            "newsletters",
            "node",
            "node_modules",
            "note",
            "notes",
            "notification",
            "notifications",
            "oauth",
            "object",
            "objects",
            "office",
            "online",
            "open",
            "openapi",
            "opera",
            "operation",
            "operations",
            "operator",
            "option",
            "options",
            "order",
            "orders",
            "org",
            "organization",
            "origin",
            "out",
            "outbox",
            "output",
            "overview",
            "owner",
            "package",
            "packages",
            "pager",
            "param",
            "params",
            "partner",
            "partners",
            "pass",
            "password",
            "passwords",
            "patch",
            "path",
            "paths",
            "pay",
            "payment",
            "payments",
            "pdf",
            "people",
            "performance",
            "permission",
            "permissions",
            "photo",
            "photos",
            "phpmyadmin",
            "ping",
            "pipeline",
            "pixel",
            "plan",
            "plans",
            "platform",
            "player",
            "plugin",
            "plus",
            "pm",
            "pod",
            "pods",
            "point",
            "points",
            "policy",
            "poll",
            "polls",
            "pool",
            "pop",
            "popup",
            "port",
            "post",
            "posts",
            "power",
            "preview",
            "price",
            "prices",
            "pricing",
            "print",
            "printer",
            "privacy",
            "proc",
            "process",
            "processes",
            "processing",
            "product",
            "production",
            "products",
            "profile",
            "profiles",
            "program",
            "programs",
            "project",
            "projects",
            "promo",
            "promotion",
            "promotions",
            "properties",
            "property",
            "protect",
            "protected",
            "provider",
            "providers",
            "proxy",
            "pull",
            "purchase",
            "push",
            "put",
            "query",
            "queue",
            "queues",
            "quick",
            "quote",
            "quotes",
            "random",
            "rate",
            "rating",
            "ratings",
            "raw",
            "read",
            "readme",
            "real",
            "recent",
            "record",
            "records",
            "recover",
            "recovery",
            "redirect",
            "reference",
            "references",
            "referral",
            "referrals",
            "refresh",
            "registration",
            "release",
            "releases",
            "reload",
            "remote",
            "remove",
            "render",
            "reply",
            "report",
            "reporting",
            "request",
            "requests",
            "res",
            "reset",
            "resolution",
            "resolve",
            "resource",
            "response",
            "responses",
            "rest",
            "restore",
            "result",
            "results",
            "retail",
            "return",
            "returns",
            "review",
            "reviews",
            "revision",
            "revisions",
            "rights",
            "robot",
            "robots",
            "robots.txt",
            "role",
            "roles",
            "root",
            "route",
            "router",
            "routes",
            "routing",
            "rpc",
            "rss",
            "rule",
            "rules",
            "run",
            "runtime",
            "safe",
            "sale",
            "sales",
            "sample",
            "samples",
            "sandbox",
            "save",
            "saved",
            "scan",
            "schedule",
            "scheduled",
            "scheduler",
            "schema",
            "schemas",
            "scope",
            "screen",
            "screenshot",
            "screenshots",
            "script",
            "sdk",
            "secret",
            "secrets",
            "section",
            "sections",
            "select",
            "send",
            "sender",
            "seo",
            "server-status",
            "session",
            "sessions",
            "set",
            "setting",
            "settings",
            "share",
            "shared",
            "shell",
            "shipping",
            "shop",
            "shopping",
            "shortcut",
            "shortcuts",
            "show",
            "sidebar",
            "sign",
            "signin",
            "signal",
            "signals",
            "signup",
            "simple",
            "single",
            "sitemap",
            "sitemap.xml",
            "sites",
            "skin",
            "skins",
            "slide",
            "slider",
            "slides",
            "slot",
            "slots",
            "smtp",
            "snapshot",
            "snapshots",
            "snippet",
            "snippets",
            "soap",
            "social",
            "socket",
            "software",
            "solution",
            "solutions",
            "sort",
            "source",
            "sources",
            "spa",
            "space",
            "spaces",
            "spam",
            "spec",
            "special",
            "specs",
            "sql",
            "src",
            "sso",
            "ssl",
            "stable",
            "stack",
            "staff",
            "stage",
            "staging",
            "standard",
            "star",
            "stars",
            "start",
            "starter",
            "stat",
            "state",
            "statement",
            "statements",
            "states",
            "stats",
            "statistics",
            "step",
            "steps",
            "stock",
            "stop",
            "stream",
            "streaming",
            "string",
            "strings",
            "stripe",
            "structure",
            "student",
            "students",
            "studio",
            "style",
            "stylesheet",
            "stylesheets",
            "sub",
            "subdomain",
            "subdomains",
            "submit",
            "subscribe",
            "subscription",
            "subscriptions",
            "success",
            "summary",
            "super",
            "supplier",
            "suppliers",
            "swagger",
            "switch",
            "sync",
            "syntax",
            "sys",
            "sysadmin",
            "tab",
            "table",
            "tables",
            "tabs",
            "tag",
            "tags",
            "target",
            "targets",
            "task",
            "tasks",
            "tax",
            "team",
            "teams",
            "technical",
            "technology",
            "telephone",
            "tenant",
            "tenants",
            "term",
            "terminal",
            "terms",
            "text",
            "theme",
            "thread",
            "threads",
            "thumb",
            "thumbnail",
            "thumbnails",
            "thumbs",
            "ticket",
            "tickets",
            "time",
            "timeline",
            "tip",
            "tips",
            "title",
            "titles",
            "token",
            "tokens",
            "tool",
            "toolbar",
            "topic",
            "topics",
            "total",
            "tour",
            "trace",
            "track",
            "tracker",
            "tracking",
            "trade",
            "traffic",
            "training",
            "transaction",
            "transactions",
            "transfer",
            "transform",
            "translate",
            "translation",
            "translations",
            "trash",
            "tree",
            "trend",
            "trends",
            "trial",
            "trigger",
            "triggers",
            "trunk",
            "trust",
            "tutorial",
            "tutorials",
            "twitter",
            "type",
            "types",
            "ui",
            "unauthorized",
            "unsubscribe",
            "update",
            "updates",
            "upgrade",
            "uri",
            "url",
            "urls",
            "usage",
            "username",
            "usernames",
            "util",
            "utilities",
            "utility",
            "utils",
            "uuid",
            "valid",
            "validate",
            "validation",
            "validator",
            "value",
            "values",
            "var",
            "variable",
            "variables",
            "vars",
            "vault",
            "verify",
            "version",
            "versions",
            "view",
            "viewer",
            "views",
            "virtual",
            "visit",
            "visitor",
            "visitors",
            "visual",
            "voice",
            "vpn",
            "wait",
            "wallet",
            "warning",
            "warnings",
            "watch",
            "watcher",
            "weather",
            "webhook",
            "webhooks",
            "webservice",
            "webservices",
            "websocket",
            "welcome",
            "widget",
            "widgets",
            "wiki",
            "win",
            "window",
            "windows",
            "wizard",
            "word",
            "wordpress",
            "words",
            "work",
            "worker",
            "workers",
            "workflow",
            "workflows",
            "workspace",
            "workspaces",
            "world",
            "wrap",
            "write",
            "writer",
            "www",
            "yaml",
            "year",
            "years",
            "yml",
            "youtube",
            "zero",
            "zip",
            "zone",
            "zones",
        ]
        .into_iter()
        .map(String::from)
        .collect()
    }

    /// Get built-in file extension wordlist
    pub fn builtin_extensions() -> Vec<String> {
        vec![
            ".php",
            ".html",
            ".htm",
            ".js",
            ".css",
            ".txt",
            ".xml",
            ".json",
            ".asp",
            ".aspx",
            ".jsp",
            ".do",
            ".action",
            ".cgi",
            ".pl",
            ".py",
            ".rb",
            ".bak",
            ".backup",
            ".old",
            ".orig",
            ".log",
            ".sql",
            ".conf",
            ".config",
            ".ini",
            ".env",
            ".yml",
            ".yaml",
            ".zip",
            ".tar",
            ".tar.gz",
            ".rar",
            ".7z",
            ".swp",
            ".swo",
        ]
        .into_iter()
        .map(String::from)
        .collect()
    }
}

impl Default for WordlistManager {
    fn default() -> Self {
        Self::new()
    }
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_builtin_directories() {
        let dirs = WordlistManager::builtin_directories();
        assert!(dirs.len() > 100);
        assert!(dirs.contains(&"admin".into()));
        assert!(dirs.contains(&"wp-admin".into()));
    }

    #[test]
    fn test_builtin_extensions() {
        let exts = WordlistManager::builtin_extensions();
        assert!(exts.contains(&".php".into()));
        assert!(exts.contains(&".bak".into()));
    }

    #[test]
    fn test_add_words() {
        let mut wm = WordlistManager::new();
        wm.add_words(&["test".into(), "admin".into(), "test".into()]); // Duplicate

        assert_eq!(wm.len(), 2); // Deduplicated
    }
}
