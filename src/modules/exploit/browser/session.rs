use serde::{Deserialize, Serialize};
use std::time::{SystemTime, UNIX_EPOCH};

/// Represents a hooked browser "Zombie"
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct Zombie {
    pub id: String,
    pub ip: String,
    pub user_agent: String,
    pub first_seen: u64,
    pub last_seen: u64,
    pub hostname: String, // from window.location.hostname
    pub page: String,     // from window.location.pathname
    pub cookies: String,
    pub os: String,
    pub status: ZombieStatus,
}

#[derive(Debug, Clone, PartialEq, Serialize, Deserialize)]
pub enum ZombieStatus {
    Online,
    Offline,
    Active, // Currently executing a command
}

impl Zombie {
    pub fn new(id: String, ip: String) -> Self {
        Self {
            id,
            ip,
            user_agent: String::new(),
            first_seen: SystemTime::now()
                .duration_since(UNIX_EPOCH)
                .unwrap()
                .as_secs(),
            last_seen: SystemTime::now()
                .duration_since(UNIX_EPOCH)
                .unwrap()
                .as_secs(),
            hostname: String::new(),
            page: String::new(),
            cookies: String::new(),
            os: String::new(),
            status: ZombieStatus::Online,
        }
    }

    pub fn heartbeat(&mut self) {
        self.last_seen = SystemTime::now()
            .duration_since(UNIX_EPOCH)
            .unwrap()
            .as_secs();
        self.status = ZombieStatus::Online;
    }
}
