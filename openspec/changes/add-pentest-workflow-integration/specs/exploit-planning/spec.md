# Exploit Planning Capability

## ADDED Requirements

### Requirement: Attack Plan Generation
The system SHALL generate actionable attack plans based on discovered vulnerabilities and technologies.

#### Scenario: Generate attack plan
- **WHEN** user runs `rb exploit plan <target>`
- **THEN** system loads vulnerabilities and fingerprints from database
- **AND** analyzes attack surface
- **AND** generates multi-phase attack plan:
  - Phase 1: Initial Access options
  - Phase 2: Privilege Escalation vectors
  - Phase 3: Lateral Movement techniques
  - Phase 4: Persistence methods
- **AND** displays plan with suggested rb commands

#### Scenario: No vulnerability data
- **WHEN** user runs `rb exploit plan <target>` with no stored vulnerabilities
- **THEN** system displays "No vulnerability data found. Run 'rb vuln correlate' first."

#### Scenario: Display plan phases
- **WHEN** attack plan is generated
- **THEN** each phase shows:
  - Attack options ranked by confidence
  - Associated CVE (if applicable)
  - Exploit reference (if available)
  - Suggested rb command to execute
  - Risk level and prerequisites

### Requirement: Exploit Suggestion Engine
The system SHALL suggest available exploits for discovered vulnerabilities.

#### Scenario: Suggest exploits
- **WHEN** user runs `rb exploit suggest <target>`
- **THEN** system loads stored CVEs
- **AND** maps CVEs to known exploits:
  - Metasploit modules
  - Exploit-DB entries
  - Built-in redblue payloads
- **AND** ranks suggestions by:
  - Reliability (verified > unverified)
  - Impact (RCE > DoS)
  - Ease of use (one-liner > complex)
- **AND** displays with execution commands

#### Scenario: No exploits available
- **WHEN** no known exploits map to stored CVEs
- **THEN** system displays "No known exploits for discovered vulnerabilities"
- **AND** suggests manual techniques based on technologies

### Requirement: Attack Chain Visualization
The system SHALL visualize potential attack chains from initial access to objective.

#### Scenario: Display attack chain
- **WHEN** user runs `rb exploit chain <target>`
- **THEN** system analyzes:
  - Entry points (web, SSH, services)
  - Privilege escalation paths
  - Pivot opportunities (internal IPs, credentials)
  - Data exfiltration routes
- **AND** displays ASCII diagram of attack chain
- **AND** shows step-by-step commands

#### Scenario: Multiple attack paths
- **WHEN** multiple attack paths exist
- **THEN** system displays all paths ranked by:
  - Total steps (shorter = better)
  - Detection risk (stealthier = better)
  - Success probability

### Requirement: Exploit Attempt Tracking
The system SHALL track exploitation attempts and their results.

#### Scenario: Store exploit attempt
- **WHEN** user executes an exploit via redblue
- **THEN** system stores ExploitAttemptRecord with:
  - Target (host:port)
  - CVE ID (if applicable)
  - Exploit name
  - Technique (MITRE ATT&CK ID)
  - Status (Success/Failed/Pending/Skipped)
  - Output (stdout/stderr)
  - Timestamp
  - Duration

#### Scenario: Query exploit history
- **WHEN** user runs `rb exploit history <target>`
- **THEN** system displays all exploit attempts with timestamps and results

### Requirement: MITRE ATT&CK Mapping
The system SHALL map attack techniques to MITRE ATT&CK framework.

#### Scenario: Display ATT&CK techniques
- **WHEN** generating attack plan or chain
- **THEN** system includes MITRE ATT&CK technique IDs:
  - T1190 (Exploit Public-Facing Application)
  - T1078 (Valid Accounts)
  - T1068 (Exploitation for Privilege Escalation)
  - T1021 (Remote Services)
  - T1053 (Scheduled Task/Job)
- **AND** provides links to MITRE documentation

### Requirement: Initial Access Technique Analysis
The system SHALL identify initial access techniques based on attack surface.

#### Scenario: Web application initial access
- **WHEN** target has web services with vulnerabilities
- **THEN** system suggests:
  - CVE exploits for web frameworks
  - SQL injection (if form detected)
  - File upload vulnerabilities
  - Authentication bypass

#### Scenario: SSH initial access
- **WHEN** target has SSH service
- **THEN** system suggests:
  - Credential bruteforce (with rate limiting)
  - Key-based attacks (known weak keys)
  - CVE exploits for OpenSSH version

#### Scenario: Database initial access
- **WHEN** target has exposed database service
- **THEN** system suggests:
  - Default credential testing
  - CVE exploits for database version
  - UDF injection techniques

### Requirement: Privilege Escalation Enumeration
The system SHALL identify privilege escalation vectors.

#### Scenario: Linux privilege escalation
- **WHEN** target is identified as Linux system
- **THEN** system suggests enumeration for:
  - SUID/SGID binaries
  - Sudo misconfigurations
  - Kernel vulnerabilities
  - Cron job exploitation
  - Writable paths in $PATH
  - Capabilities exploitation

#### Scenario: Windows privilege escalation
- **WHEN** target is identified as Windows system
- **THEN** system suggests enumeration for:
  - Unquoted service paths
  - Always Install Elevated
  - Token impersonation
  - Kernel exploits (if version known)
  - Scheduled tasks
