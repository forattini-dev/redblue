# Port Health Check Capability

## ADDED Requirements

### Requirement: Port State Re-verification
The system SHALL re-scan previously discovered ports to detect state changes.

#### Scenario: Check stored ports
- **WHEN** user runs `rb network ports check <target>`
- **THEN** system loads stored open ports from database
- **AND** performs TCP connect scan on each stored port
- **AND** compares current state with stored state
- **AND** displays diff summary (still open, now closed, new open)

#### Scenario: No stored ports
- **WHEN** user runs `rb network ports check <target>` with no prior scan data
- **THEN** system displays message "No stored ports found for target. Run 'rb network ports scan' first."

#### Scenario: Target unreachable
- **WHEN** user runs `rb network ports check <target>` and target is unreachable
- **THEN** system displays error with suggestion to verify network connectivity

### Requirement: Port State Diff Display
The system SHALL display port state changes with visual indicators.

#### Scenario: Display port diff
- **WHEN** port check completes with state changes
- **THEN** system displays:
  - Green checkmark (‚úÖ) for ports still open
  - Red X (‚ùå) for ports now closed
  - Blue plus (üÜï) for newly discovered open ports
- **AND** shows summary count: "N still open, M closed, P new"

#### Scenario: No changes detected
- **WHEN** all stored ports remain in same state
- **THEN** system displays "All ports unchanged since last scan"

### Requirement: Continuous Port Monitoring
The system SHALL support continuous port monitoring with configurable interval.

#### Scenario: Start port watch
- **WHEN** user runs `rb network ports watch <target> --interval 60`
- **THEN** system performs initial port check
- **AND** repeats check every 60 seconds
- **AND** displays timestamp and any state changes
- **AND** continues until user presses Ctrl+C

#### Scenario: Alert on port state change
- **WHEN** port state changes during watch mode
- **THEN** system displays highlighted alert with port number and new state
- **AND** plays terminal bell (optional, via flag)

### Requirement: Port Health History
The system SHALL persist port health check results with timestamps.

#### Scenario: Store health check result
- **WHEN** port check completes
- **THEN** system stores PortHealthRecord for each port with:
  - Previous state
  - Current state
  - First seen timestamp
  - Last seen timestamp
  - State change timestamp (if changed)
  - Check count

#### Scenario: Query health history
- **WHEN** user runs `rb network ports history <target>`
- **THEN** system displays port state timeline for each port
