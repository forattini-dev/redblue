# =============================================================================
# RedBlue Vulnerable Lab - For Testing Assessment Workflow
# =============================================================================
# This lab contains intentionally vulnerable applications for security testing.
# DO NOT expose these services to the internet!
#
# Usage:
#   cd docker/vulnerable-lab
#   docker compose up -d
#
# Then test with:
#   rb assess target run http://localhost:8080 --dry-run   # DVWA
#   rb assess target run http://localhost:3000 --dry-run   # Juice Shop
#   rb assess target run http://localhost:8083 --dry-run   # nginx-vuln
# =============================================================================

services:
  # ---------------------------------------------------------------------------
  # DVWA - Damn Vulnerable Web Application
  # PHP + MySQL with intentional vulnerabilities
  # Default login: admin / password
  # ---------------------------------------------------------------------------
  dvwa:
    image: vulnerables/web-dvwa:latest
    container_name: rb-dvwa
    ports:
      - "8080:80"
    networks:
      - vuln-net
    restart: unless-stopped

  # ---------------------------------------------------------------------------
  # OWASP Juice Shop - Modern vulnerable web app
  # Node.js with OWASP Top 10 vulnerabilities
  # CTF challenges included!
  # ---------------------------------------------------------------------------
  juice-shop:
    image: bkimminich/juice-shop:latest
    container_name: rb-juice-shop
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=ctf
    networks:
      - vuln-net
    restart: unless-stopped

  # ---------------------------------------------------------------------------
  # Vulnerable nginx - Old version with known CVEs
  # nginx 1.16.0 with security misconfigurations
  # ---------------------------------------------------------------------------
  nginx-vuln:
    image: nginx:1.16.0
    container_name: rb-nginx-vuln
    ports:
      - "8083:80"
    volumes:
      - ./nginx-vuln/html:/usr/share/nginx/html:ro
      - ./nginx-vuln/nginx.conf:/etc/nginx/nginx.conf:ro
    networks:
      - vuln-net
    restart: unless-stopped

  # ---------------------------------------------------------------------------
  # WebGoat - OWASP Training Platform
  # Java-based with lessons and challenges
  # ---------------------------------------------------------------------------
  webgoat:
    image: webgoat/webgoat:latest
    container_name: rb-webgoat
    ports:
      - "8082:8080"
      - "9090:9090"
    environment:
      - WEBGOAT_HOST=0.0.0.0
      - WEBGOAT_PORT=8080
    networks:
      - vuln-net
    restart: unless-stopped

networks:
  vuln-net:
    driver: bridge
